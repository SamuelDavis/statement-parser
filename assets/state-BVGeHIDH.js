import{k as v,t as M,l as w,i as D,m as F,n as k,e as y,p as x,j as m,b as f}from"./index-Dt_LWpRi.js";import{d as S,c as d,i as $,a as l,F as T,f as h,h as j,s as E,t as N,j as J}from"./types-qmVODdHK.js";var L=M("<span>");function H(n){const[s,p]=v(n,["value"]);return(()=>{var r=L();return w(r,p,!1,!0),D(r,()=>s.value.toLocaleDateString()),r})()}var P=M("<span>");function I(n){n=F({locale:"en-US",precision:2,currency:!0},n);const[s,p]=v(n,["value","locale","currency","precision"]);return(()=>{var r=P();return w(r,F({get classList(){return{currency:s.currency,positive:s.currency&&s.value>0,negative:s.currency&&s.value<0}}},p),!1,!0),D(r,()=>s.value.toLocaleString(s.locale,{minimumFractionDigits:s.precision,maximumFractionDigits:s.precision})),r})()}function V(n){return S(n)?n.length>0?n:void 0:n instanceof RegExp?n.source.length===0||n.source==="(?:)"?void 0:n:n||void 0}function O(n,s){const[p,r]=n,{key:c,encode:o=JSON.stringify,decode:g=JSON.parse,driver:i="local"}=s;switch(i){case"local":{const e=localStorage.getItem(c);d(e)&&r(g(e)),y(()=>localStorage.setItem(c,o(p())));break}case"query":{const[e,t]=k(),a=e[c];d(a)&&r(g(a)),y(()=>{const u=o(p());t({[c]:d(u)&&u.replace(/(^"|"$)/g,"").length>0?u:null})});break}}return n}const q=x(()=>{const[n,s]=f(),[p,r]=f({}),c=m(()=>{const t=p();return h(t,N)?t:void 0}),o=m(()=>{const t=n();if(!t)return;const a=c();if(a)return{name:t.name,date:new Date,transactions:t.rows.map(u=>({date:new Date(u[a.date]),description:String(u[a.description]),amount:Number(u[a.amount])}))}});y(()=>{n()||r({})});function g(t,a){r(u=>({...u,[t]:a}))}function i(){return n()?.fields}function e(t,a){return p()[t]===a}return{setUpload:s,getStatement:o,mapField:g,getFields:i,isSelected:e}}),R=x(()=>{const[n,s]=O(f([]),{key:"statements",decode(r){return r=JSON.parse(r),l(S,r),r.map(c=>{l(h,c,E);const{date:o,name:g,transactions:i}=c;return l(d,o),l(d,g),l(S,i),{date:new Date(o),name:g,transactions:i.map(e=>{l(h,e,N);const{date:t,description:a,amount:u}=e;return l(d,t),l(d,a),l(J,u),{date:new Date(t),description:a,amount:u}})}})}});function p(r){s(c=>[...c,r])}return{get:n,add:p}}),b=x(()=>{const[n,s]=O(f([]),{key:"tags",encode(e){return JSON.stringify(e.map(t=>({...t,regexp:t.regexp.source})))},decode(e){return e=JSON.parse(e),l(S,e),e.map(t=>{l(h,t,j);const{value:a,regexp:u}=t;return l(d,a),l(d,u),{value:a,regexp:new RegExp(u,T)}})}});function p(e){s(t=>[...t,e])}function r(e){return i().filter(t=>e.description.match(t.regexp))}function c(e,t){s(a=>a.map(u=>u.value===e.value?t:u))}const o=m(()=>n().map(e=>e.regexp.source)),g=m(()=>n().map(e=>e.value));function i(){const e={};for(const t of n()){const a=e[t.value]??[];a.includes(t.regexp.source)||a.push(t.regexp.source),e[t.value]=a}return Object.entries(e).map(([t,a])=>({value:t,regexp:new RegExp(a.join("|"),T)}))}return{get:i,add:p,matching:r,getSources:o,getValues:g,changeValue:c}}),A=x(()=>{const n=m(()=>R.get().flatMap(c=>c.transactions).sort((c,o)=>o.date.getTime()-c.date.getTime())),s=m(()=>{const c=n(),o=b.get();return c.map(g=>({...g,tags:o.filter(i=>g.description.match(i.regexp))}))}),p=m(()=>{const c=n(),o=b.get();return c.filter(g=>!o.some(i=>g.description.match(i.regexp)))});function r(c={}){const{matching:o,untagged:g}=c;let i=s();return $(o,RegExp)&&(i=i.filter(e=>e.description.match(o))),g&&(i=i.filter(e=>e.tags.length===0)),i}return{findTransactions:r,getUntaggedTransactions:p,getTaggedTransactions:s}});export{H,I as a,q as b,A as d,O as p,R as s,b as t,V as u};
