import{j as w,t as v,k as B,i as M,m as x,l as J,e as T,n as h,b as S,p as f}from"./index-B-LCzFF1.js";import{c as y,d as D,g as L,F as k,f as b,i as P,a as m,h as j,s as C,t as O,j as I}from"./types-qmVODdHK.js";var U=v("<span>");function z(n){const[s,u]=w(n,["value"]);return(()=>{var r=U();return B(r,u,!1,!0),M(r,()=>s.value.toLocaleDateString()),r})()}var _=v("<span>");function K(n){n=x({locale:"en-US",precision:2,currency:!0},n);const[s,u]=w(n,["value","locale","currency","precision"]);return(()=>{var r=_();return B(r,x({get classList(){return{currency:s.currency,positive:s.currency&&s.value>0,negative:s.currency&&s.value<0}}},u),!1,!0),M(r,()=>s.value.toLocaleString(s.locale,{minimumFractionDigits:s.precision,maximumFractionDigits:s.precision})),r})()}function Q(n){return D(n)?n.length>0?n:void 0:n instanceof RegExp?n.source.length===0||n.source==="(?:)"?void 0:n:n||void 0}function N(n,s){const[u,r]=n,{key:c,encode:l=JSON.stringify,decode:p=JSON.parse,driver:a="local"}=s;switch(a){case"local":{const o=localStorage.getItem(c);y(o)&&r(p(o)),T(()=>localStorage.setItem(c,l(u())));break}case"query":{const[o,i]=J();T(()=>{const e=l(u());e.replace(/(^"|"$)/g,"").length>0&&i({[c]:e})}),T(()=>{const e=o[c];y(e)&&r(p(e))});break}}return n}const W=h(()=>{const[n,s]=S(),[u,r]=S({}),c=f(()=>{const i=u();return b(i,O)?i:void 0}),l=f(()=>{const i=n();if(!i)return;const e=c();if(e)return{name:i.name,date:new Date,transactions:i.rows.map(t=>({date:new Date(t[e.date]),description:String(t[e.description]),amount:Number(t[e.amount])}))}});T(()=>{n()||r({})});function p(i,e){r(t=>({...t,[i]:e}))}function a(){return n()?.fields}function o(i,e){return u()[i]===e}return{setUpload:s,getStatement:l,mapField:p,getFields:a,isSelected:o}}),G=h(()=>{const[n,s]=N(S([]),{key:"statements",decode(r){return r=JSON.parse(r),m(D,r),r.map(c=>{m(b,c,C);const{date:l,name:p,transactions:a}=c;return m(y,l),m(y,p),m(D,a),{date:new Date(l),name:p,transactions:a.map(o=>{m(b,o,O);const{date:i,description:e,amount:t}=o;return m(y,i),m(y,e),m(I,t),{date:new Date(i),description:e,amount:t}})}})}});function u(r){s(c=>[...c,r])}return{get:n,add:u}}),H=h(()=>{const[n,s]=N(S([]),{key:"tags",encode(a){return JSON.stringify(a.map(o=>({...o,regexp:o.regexp.source})))},decode(a){return a=JSON.parse(a),m(D,a),a.map(o=>{m(b,o,j);const{value:i,regexp:e}=o;return m(y,i),m(y,e),{value:i,regexp:new RegExp(e,k)}})}});function u(a){s(o=>[...o,a])}function r(a){return n().filter(o=>a.description.match(o.regexp))}function c(a,o){s(i=>i.map(e=>e.value===a.value?{...e,value:o}:e))}const l=f(()=>n().map(a=>a.regexp.source)),p=f(()=>n().map(a=>a.value));return{get:n,add:u,matching:r,getSources:l,getValues:p,changeValue:c}}),A=h(()=>{const n=f(()=>G.get().flatMap(r=>r.transactions).sort((r,c)=>c.date.getTime()-r.date.getTime())),s=f(()=>{const r=n(),c=H.get();return r.filter(l=>!c.some(p=>l.description.match(p.regexp)))});function u(r={}){const{matching:c,untagged:l}=r,p=l?s():n();return P(c,RegExp)?p.filter(a=>a.description.match(c)):p}return{getTransactions:u,getUntaggedTransactions:s}}),X=h(()=>{const[n,s]=S(L[0]),[u,r]=S(""),c=()=>{const e=u();return e===""?void 0:new RegExp(e,k)},l=f(()=>{const e=A.getTransactions(),t=c();return t===void 0?e:e.filter(g=>g.description.match(t))}),p=f(()=>{const e=n();return l().reduce((t,g)=>{const d=i(e,g.date).toISOString();return t[d]=t[d]??[],t[d].push(g),t},{})}),a=f(()=>{let e=0;return Object.entries(p()).sort(([t],[g])=>new Date(t).getTime()-new Date(g).getTime()).map(([t,g])=>{const d=new Date(t),F=g.reduce(($,E)=>$+E.amount,0),R=F-e;return e=F,{groupBy:d,total:F,change:R,transactions:g}}).reverse()}),o=()=>{const e=a().map(t=>({...t,label:t.groupBy.toDateString()})).reverse();return{labels:e.map(t=>t.label),datasets:[{label:"total",data:e.map(t=>t.total),backgroundColor(t){const g=e[t.index].total,d=e[t.index-1]?.total??g;return g>=d?"green":"red"},segment:{borderColor(t){const g=t.p0.y,d=t.p1.y;return g>=d?"green":"red"}}}]}};function i(e,t){const g=new Date(t);let d=t.getDate();return e==="month"&&(d=1),e==="week"&&(d=Math.floor(t.getDate()/7)*7+1),g.setDate(d),g}return{setGroupBy:s,setFilterByTag:r,getTableData:a,getChartData:o}});export{z as H,X as a,K as b,Q as c,A as d,N as p,G as s,H as t,W as u};
