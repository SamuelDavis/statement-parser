import{k as b,t as M,l as w,i as D,m as F,n as k,e as y,p as S,j as m,b as f}from"./index-MmfDRyuv.js";import{d as h,c as d,i as $,a as l,F as T,u as j,f as x,h as E,s as J,t as N,j as L}from"./types-CSXfi8fR.js";var P=M("<span>");function I(n){const[r,p]=b(n,["value"]);return(()=>{var a=P();return w(a,p,!1,!0),D(a,()=>r.value.toLocaleDateString()),a})()}var R=M("<span>");function V(n){n=F({locale:"en-US",precision:2,currency:!0},n);const[r,p]=b(n,["value","locale","currency","precision"]);return(()=>{var a=R();return w(a,F({get classList(){return{currency:r.currency,positive:r.currency&&r.value>0,negative:r.currency&&r.value<0}}},p),!1,!0),D(a,()=>r.value.toLocaleString(r.locale,{minimumFractionDigits:r.precision,maximumFractionDigits:r.precision})),a})()}function q(n){return h(n)?n.length>0?n:void 0:n instanceof RegExp?n.source.length===0||n.source==="(?:)"?void 0:n:n||void 0}function O(n,r){const[p,a]=n,{key:c,encode:i=JSON.stringify,decode:g=JSON.parse,driver:o="local"}=r;switch(o){case"local":{const t=localStorage.getItem(c);d(t)&&a(g(t)),y(()=>localStorage.setItem(c,i(p())));break}case"query":{const[t,e]=k(),s=t[c];d(s)&&a(g(s)),y(()=>{const u=i(p());e({[c]:d(u)&&u.replace(/(^"|"$)/g,"").length>0?u:null})});break}}return n}const A=S(()=>{const[n,r]=f(),[p,a]=f({}),c=m(()=>{const e=p();return x(e,N)?e:void 0}),i=m(()=>{const e=n();if(!e)return;const s=c();if(s)return{name:e.name,date:new Date,transactions:e.rows.map(u=>({date:new Date(u[s.date]),description:String(u[s.description]),amount:Number(u[s.amount])}))}});y(()=>{n()||a({})});function g(e,s){a(u=>({...u,[e]:s}))}function o(){return n()?.fields}function t(e,s){return p()[e]===s}return{setUpload:r,getStatement:i,mapField:g,getFields:o,isSelected:t}}),U=S(()=>{const[n,r]=O(f([]),{key:"statements",decode(a){return a=JSON.parse(a),l(h,a),a.map(c=>{l(x,c,J);const{date:i,name:g,transactions:o}=c;return l(d,i),l(d,g),l(h,o),{date:new Date(i),name:g,transactions:o.map(t=>{l(x,t,N);const{date:e,description:s,amount:u}=t;return l(d,e),l(d,s),l(L,u),{date:new Date(e),description:s,amount:u}})}})}});function p(a){r(c=>[...c,a])}return{get:n,add:p}}),v=S(()=>{const[n,r]=O(f([]),{key:"tags",encode(t){return JSON.stringify(t.map(e=>({...e,regexp:e.regexp.source})))},decode(t){return t=JSON.parse(t),l(h,t),t.map(e=>{l(x,e,E);const{value:s,regexp:u}=e;return l(d,s),l(d,u),{value:s,regexp:new RegExp(u,T)}})}});function p(t){r(e=>[...e,t])}function a(t){return o().filter(e=>t.description.match(e.regexp))}function c(t,e){r(s=>s.map(u=>u.value===t.value?e:u))}const i=m(()=>{const t=[];for(const e of n())t.includes(e.regexp.source)||t.push(e.regexp.source);return t}),g=m(()=>{const t=[j];for(const e of n())t.includes(e.value)||t.push(e.value);return t});function o(){const t={};for(const e of n()){const s=t[e.value]??[];s.includes(e.regexp.source)||s.push(e.regexp.source),t[e.value]=s}return Object.entries(t).map(([e,s])=>({value:e,regexp:new RegExp(s.join("|"),T)}))}return{get:o,add:p,matching:a,getSources:i,getValues:g,changeValue:c}}),C=S(()=>{const n=m(()=>U.get().flatMap(c=>c.transactions).sort((c,i)=>i.date.getTime()-c.date.getTime())),r=m(()=>{const c=n(),i=v.get();return c.map(g=>({...g,tags:i.filter(o=>g.description.match(o.regexp))}))}),p=m(()=>{const c=n(),i=v.get();return c.filter(g=>!i.some(o=>g.description.match(o.regexp)))});function a(c={}){const{matching:i,untagged:g}=c;let o=r();return $(i,RegExp)&&(o=o.filter(t=>t.description.match(i))),g&&(o=o.filter(t=>t.tags.length===0)),o}return{findTransactions:a,getUntaggedTransactions:p,getTaggedTransactions:r}});export{I as H,V as a,A as b,C as d,O as p,U as s,v as t,q as u};
