import{n as v,e as f,p as F,j as m,b as S,k as b,t as M,l as T,i as D,m as x}from"./index-HWEJQZVc.js";import{c as d,d as h,i as w,a as p,F as O,f as y,h as $,j as J,s as L,t as N,k as P}from"./types-DLJIS_uM.js";function I(e){return h(e)?e.length>0?e:void 0:e instanceof RegExp?e.source.length===0||e.source==="(?:)"?void 0:e:e||void 0}function k(e,a){const[o,t]=e,{key:c,encode:l=JSON.stringify,decode:u=JSON.parse,driver:n="local"}=a;switch(n){case"local":{const s=localStorage.getItem(c);d(s)&&t(u(s)),f(()=>localStorage.setItem(c,l(o())));break}case"query":{const[s,i]=v();f(()=>{const r=l(o());i({[c]:r.replace(/(^"|"$)/g,"").length>0?r:null})}),f(()=>{const r=s[c];d(r)&&t(u(r))});break}}return e}const A=F(()=>{const[e,a]=S(),[o,t]=S({}),c=m(()=>{const i=o();return y(i,N)?i:void 0}),l=m(()=>{const i=e();if(!i)return;const r=c();if(r)return{name:i.name,date:new Date,transactions:i.rows.map(g=>({date:new Date(g[r.date]),description:String(g[r.description]),amount:Number(g[r.amount])}))}});f(()=>{e()||t({})});function u(i,r){t(g=>({...g,[i]:r}))}function n(){return e()?.fields}function s(i,r){return o()[i]===r}return{setUpload:a,getStatement:l,mapField:u,getFields:n,isSelected:s}}),E=F(()=>{const[e,a]=k(S([]),{key:"statements",decode(t){return t=JSON.parse(t),p(h,t),t.map(c=>{p(y,c,L);const{date:l,name:u,transactions:n}=c;return p(d,l),p(d,u),p(h,n),{date:new Date(l),name:u,transactions:n.map(s=>{p(y,s,N);const{date:i,description:r,amount:g}=s;return p(d,i),p(d,r),p(P,g),{date:new Date(i),description:r,amount:g}})}})}});function o(t){a(c=>[...c,t])}return{get:e,add:o}}),R=F(()=>{const[e,a]=k(S([]),{key:"tags",encode(n){return JSON.stringify(n.map(s=>({...s,regexp:s.regexp.source})))},decode(n){return n=JSON.parse(n),p(h,n),n.map(s=>{p(y,s,$);const{value:i,regexp:r,ignore:g}=s;return p(d,i),p(d,r),p(J,g),{value:i,regexp:new RegExp(r,O),ignore:g}})}});function o(n){a(s=>[...s,n])}function t(n){return e().filter(s=>n.description.match(s.regexp))}function c(n,s){a(i=>i.map(r=>r.value===n.value?s:r))}const l=m(()=>e().map(n=>n.regexp.source)),u=m(()=>e().map(n=>n.value));return{get:e,add:o,matching:t,getSources:l,getValues:u,changeValue:c}}),V=F(()=>{const e=m(()=>E.get().flatMap(t=>t.transactions).sort((t,c)=>c.date.getTime()-t.date.getTime())),a=m(()=>{const t=e(),c=R.get();return t.filter(l=>!c.some(u=>l.description.match(u.regexp)))});function o(t={}){const{matching:c,untagged:l}=t,u=l?a():e();return w(c,RegExp)?u.filter(n=>n.description.match(c)):u}return{getTransactions:o,getUntaggedTransactions:a}});var U=M("<span>");function q(e){const[a,o]=b(e,["value"]);return(()=>{var t=U();return T(t,o,!1,!0),D(t,()=>a.value.toLocaleDateString()),t})()}var _=M("<span>");function B(e){e=x({locale:"en-US",precision:2,currency:!0},e);const[a,o]=b(e,["value","locale","currency","precision"]);return(()=>{var t=_();return T(t,x({get classList(){return{currency:a.currency,positive:a.currency&&a.value>0,negative:a.currency&&a.value<0}}},o),!1,!0),D(t,()=>a.value.toLocaleString(a.locale,{minimumFractionDigits:a.precision,maximumFractionDigits:a.precision})),t})()}export{q as H,B as a,I as b,V as d,k as p,E as s,R as t,A as u};
