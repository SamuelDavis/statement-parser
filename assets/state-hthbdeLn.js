import{k as v,t as M,l as w,i as D,m as F,n as k,e as y,p as x,j as m,b as f}from"./index-Dhli0x_y.js";import{d as h,c as d,i as $,a as l,F as T,u as j,f as S,h as E,s as J,t as N,j as L}from"./types-CNH3L-Sn.js";var P=M("<span>");function I(n){const[s,p]=v(n,["value"]);return(()=>{var r=P();return w(r,p,!1,!0),D(r,()=>s.value.toLocaleDateString()),r})()}var R=M("<span>");function V(n){n=F({locale:"en-US",precision:2,currency:!0},n);const[s,p]=v(n,["value","locale","currency","precision"]);return(()=>{var r=R();return w(r,F({get classList(){return{currency:s.currency,positive:s.currency&&s.value>0,negative:s.currency&&s.value<0}}},p),!1,!0),D(r,()=>s.value.toLocaleString(s.locale,{minimumFractionDigits:s.precision,maximumFractionDigits:s.precision})),r})()}function q(n){return h(n)?n.length>0?n:void 0:n instanceof RegExp?n.source.length===0||n.source==="(?:)"?void 0:n:n||void 0}function O(n,s){const[p,r]=n,{key:c,encode:o=JSON.stringify,decode:g=JSON.parse,driver:i="local"}=s;switch(i){case"local":{const t=localStorage.getItem(c);d(t)&&r(g(t)),y(()=>localStorage.setItem(c,o(p())));break}case"query":{const[t,e]=k(),a=t[c];d(a)&&r(g(a)),y(()=>{const u=o(p());e({[c]:d(u)&&u.replace(/(^"|"$)/g,"").length>0?u:null})});break}}return n}const A=x(()=>{const[n,s]=f(),[p,r]=f({}),c=m(()=>{const e=p();return S(e,N)?e:void 0}),o=m(()=>{const e=n();if(!e)return;const a=c();if(a)return{name:e.name,date:new Date,transactions:e.rows.map(u=>({date:new Date(u[a.date]),description:String(u[a.description]),amount:Number(u[a.amount])}))}});y(()=>{n()||r({})});function g(e,a){r(u=>({...u,[e]:a}))}function i(){return n()?.fields}function t(e,a){return p()[e]===a}return{setUpload:s,getStatement:o,mapField:g,getFields:i,isSelected:t}}),U=x(()=>{const[n,s]=O(f([]),{key:"statements",decode(r){return r=JSON.parse(r),l(h,r),r.map(c=>{l(S,c,J);const{date:o,name:g,transactions:i}=c;return l(d,o),l(d,g),l(h,i),{date:new Date(o),name:g,transactions:i.map(t=>{l(S,t,N);const{date:e,description:a,amount:u}=t;return l(d,e),l(d,a),l(L,u),{date:new Date(e),description:a,amount:u}})}})}});function p(r){s(c=>[...c,r])}return{get:n,add:p}}),b=x(()=>{const[n,s]=O(f([]),{key:"tags",encode(t){return JSON.stringify(t.map(e=>({...e,regexp:e.regexp.source})))},decode(t){return t=JSON.parse(t),l(h,t),t.map(e=>{l(S,e,E);const{value:a,regexp:u}=e;return l(d,a),l(d,u),{value:a,regexp:new RegExp(u,T)}})}});function p(t){s(e=>[...e,t])}function r(t){return i().filter(e=>t.description.match(e.regexp))}function c(t,e){s(a=>a.map(u=>u.value===t.value?e:u))}const o=m(()=>n().map(t=>t.regexp.source)),g=m(()=>{const t=n().map(e=>e.value);return t.unshift(j),t});function i(){const t={};for(const e of n()){const a=t[e.value]??[];a.includes(e.regexp.source)||a.push(e.regexp.source),t[e.value]=a}return Object.entries(t).map(([e,a])=>({value:e,regexp:new RegExp(a.join("|"),T)}))}return{get:i,add:p,matching:r,getSources:o,getValues:g,changeValue:c}}),C=x(()=>{const n=m(()=>U.get().flatMap(c=>c.transactions).sort((c,o)=>o.date.getTime()-c.date.getTime())),s=m(()=>{const c=n(),o=b.get();return c.map(g=>({...g,tags:o.filter(i=>g.description.match(i.regexp))}))}),p=m(()=>{const c=n(),o=b.get();return c.filter(g=>!o.some(i=>g.description.match(i.regexp)))});function r(c={}){const{matching:o,untagged:g}=c;let i=s();return $(o,RegExp)&&(i=i.filter(t=>t.description.match(o))),g&&(i=i.filter(t=>t.tags.length===0)),i}return{findTransactions:r,getUntaggedTransactions:p,getTaggedTransactions:s}});export{I as H,V as a,A as b,C as d,O as p,U as s,b as t,q as u};
